<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSBC AI-Agent: The Complete Journey</title>
    <style>
        /* --- Ê†∏ÂøÉËßÜËßâÂèòÈáè --- */
        :root {
            --bg-dark: #0f1012;
            --panel-left: #16181c;
            --hsbc-red: #db0011;
            --gold: #c6a87c;
            --term-green: #27c93f;
            --term-blue: #00a2ff;
            --text-main: #ececec;
        }

        body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- Â∑¶‰æßÔºöÂâßÊú¨‰∏éÂêéÂè∞ (Narrative) --- */
        .story-panel {
            width: 55%;
            padding: 40px;
            border-right: 1px solid #333;
            overflow-y: auto;
            background: #111;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .header-title {
            font-size: 1.4rem; color: var(--gold); 
            border-bottom: 2px solid var(--hsbc-red); padding-bottom: 15px; margin-bottom: 10px;
        }

        .scene-card {
            background: rgba(255, 255, 255, 0.03);
            border-left: 4px solid #333;
            padding: 20px;
            border-radius: 0 8px 8px 0;
            opacity: 0.3; transform: translateX(-10px);
            transition: all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .scene-card.active {
            opacity: 1; border-left-color: var(--gold);
            background: linear-gradient(90deg, rgba(198, 168, 124, 0.1) 0%, transparent 100%);
            transform: translateX(0);
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
        }

        .scene-header { font-size: 0.8rem; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; display: flex; justify-content: space-between;}
        .scene-title { font-size: 1.1rem; font-weight: bold; color: #fff; margin-bottom: 10px; }
        .scene-desc { font-size: 1rem; color: #ccc; line-height: 1.5; margin-bottom: 15px; }

        .system-log {
            font-family: 'Fira Code', 'Monaco', monospace;
            font-size: 0.8rem; background: #000; padding: 12px;
            border-radius: 6px; border: 1px solid #333; color: #aaa;
        }
        .term-val { color: var(--term-green); }
        .term-key { color: var(--term-blue); }
        .term-warn { color: #ff9f43; }
        .term-line { display: block; margin-bottom: 4px; }

        /* --- Âè≥‰æßÔºöÊâãÊú∫Ê®°ÊãüÂô® (Device) --- */
        .device-stage {
            width: 45%;
            background: radial-gradient(circle at center, #23252b 0%, #000 100%);
            display: flex; justify-content: center; align-items: center;
            position: relative;
        }

        .phone-frame {
            width: 375px; height: 800px;
            background: #000; border-radius: 45px;
            border: 8px solid #222; position: relative; overflow: hidden;
            box-shadow: 0 40px 100px rgba(0,0,0,0.9);
        }
        .notch { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 160px; height: 32px; background: #222; border-radius: 0 0 20px 20px; z-index: 999; }

        /* --- ÊâãÊú∫ÂÜÖÁöÑÂ±èÂπï (Screens) --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column;
            animation: fadeIn 0.5s ease; background: #000;
        }
        .screen.active { display: flex; }

        /* Screen 1: Settings */
        .settings-header { padding: 60px 20px 20px; font-weight: bold; font-size: 1.8rem; color: white; background: #1a1a1a; }
        .settings-row { display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid #333; }
        .toggle { width: 50px; height: 30px; background: var(--term-green); border-radius: 15px; position: relative; }
        .toggle::after { content:''; position: absolute; top:2px; right:2px; width:26px; height:26px; background:#fff; border-radius:50%; }

        /* Screen 2: Safari */
        .safari-bar { background: #f0f0f0; padding: 50px 20px 10px; border-bottom: 1px solid #ccc; text-align: center; }
        .url-box { background: #fff; padding: 8px; border-radius: 8px; font-size: 0.8rem; color: #333; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .gov-header { background: #000; color: white; padding: 15px; font-weight: bold; border-bottom: 4px solid #003078; font-family: sans-serif; }
        .gov-content { background: white; flex: 1; padding: 30px; text-align: center; color: black; }
        .success-icon { width: 60px; height: 60px; background: var(--term-green); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; margin: 0 auto 20px; }

        /* Screen 3: HSBC Chat */
        .app-header { padding: 50px 20px 15px; background: rgba(20,20,20,0.95); border-bottom: 1px solid #333; display: flex; align-items: center; gap: 10px; color: white; }
        .chat-container { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        
        /* Overlays */
        .notification {
            position: absolute; top: -120px; left: 10px; right: 10px;
            background: rgba(30, 30, 30, 0.95); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border-radius: 14px; padding: 15px; z-index: 2000;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5); border: 1px solid #444;
            display: flex; gap: 12px; cursor: pointer; transition: top 0.5s ease;
        }
        .notification.show { top: 10px; }

        .face-id {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 3000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }

        /* Bubbles & Widgets */
        .bubble { max-width: 85%; padding: 14px 18px; border-radius: 18px; font-size: 0.9rem; line-height: 1.4; opacity: 0; transform: translateY(10px); animation: popUp 0.4s forwards; color: white; margin-bottom: 10px; }
        .bubble.ai { align-self: flex-start; background: #1f2228; border: 1px solid #333; border-bottom-left-radius: 4px; }
        .bubble.user { align-self: flex-end; background: linear-gradient(135deg, #141e30, #243b55); border: 1px solid var(--hsbc-red); border-bottom-right-radius: 4px; }
        
        .widget { background: #000; border: 1px solid var(--gold); border-radius: 12px; padding: 15px; margin-top: 10px; }
        .w-row { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 8px; color: #aaa; }
        .w-val { color: #fff; font-family: monospace; font-weight: bold; }
        .w-btn { width: 100%; padding: 10px; background: var(--hsbc-red); border: none; color: white; border-radius: 6px; margin-top: 10px; cursor: pointer; font-weight: bold; }

        @keyframes popUp { to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { opacity: 0.5; transform: scale(0.95); } 50% { opacity: 1; transform: scale(1.05); } 100% { opacity: 0.5; transform: scale(0.95); } }

        /* Controls */
        .control-bar { position: absolute; bottom: 30px; z-index: 4000; }
        .next-btn { padding: 12px 30px; background: var(--gold); color: #000; border: none; border-radius: 30px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 20px rgba(198, 168, 124, 0.4); font-size: 1rem; }
        .next-btn:disabled { background: #333; color: #666; cursor: default; box-shadow: none; }
    </style>
</head>
<body>

<div class="story-panel" id="storyPanel">
    <div class="header-title">UC-02: User Journey & Tech Stack</div>
</div>

<div class="device-stage">
    <div class="phone-frame" id="phoneFrame">
        <div class="notch"></div>

        <div class="notification" id="notif" onclick="userClicksNotification()">
            <div style="width:40px; height:40px; background:var(--hsbc-red); border-radius:8px; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold;">H</div>
            <div style="flex:1;">
                <div style="font-size:0.8rem; font-weight:bold; color:#fff; display:flex; justify-content:space-between;">
                    <span>HSBC Premier</span> <span style="font-weight:normal; color:#aaa;">Now</span>
                </div>
                <div style="font-size:0.85rem; color:#ddd; margin-top:4px; line-height:1.2;">
                    Transaction Approved: ¬£3.00 (HM Land Registry).<br>
                    <span style="color:var(--gold);">Optimization opportunity detected. Tap to view.</span>
                </div>
            </div>
        </div>

        <div class="face-id" id="faceId">
            <div style="font-size:3rem; color:white; animation: pulse 1s infinite;">‚ò∫</div>
            <div style="color:white; margin-top:10px;">Face ID Verified</div>
        </div>

        <div class="screen active" id="scr-settings">
            <div class="settings-header">Settings</div>
            <div style="padding:0 20px; color:var(--gold); font-size:0.8rem; text-transform:uppercase;">AI Permissions</div>
            <div class="settings-row">
                <div style="color:white;">
                    <div style="font-weight:bold;">Critical Moment Intervention</div>
                    <div style="font-size:0.8rem; color:#888;">Allow real-time financial insights</div>
                </div>
                <div class="toggle"></div>
            </div>
            <div class="settings-row">
                <div style="color:white;">
                    <div style="font-weight:bold;">Smart Transaction Analysis</div>
                    <div style="font-size:0.8rem; color:#888;">Secure on-device processing</div>
                </div>
                <div class="toggle"></div>
            </div>
        </div>

        <div class="screen" id="scr-safari">
            <div class="safari-bar">
                <div class="url-box">üîí gov.uk/land-registry/payment-confirmed</div>
            </div>
            <div class="gov-header">GOV.UK</div>
            <div class="gov-content">
                <div class="success-icon">‚úì</div>
                <h2 style="margin:0 0 10px 0;">Payment Successful</h2>
                <p style="color:#555;">Amount: <strong>¬£3.00</strong></p>
                <div style="margin-top:20px; font-size:0.8rem; color:#777; border-top:1px solid #eee; padding-top:15px;">
                    Ref: #TRX-9982<br>Merchant: HM LAND REGISTRY
                </div>
            </div>
        </div>

        <div class="screen" id="scr-chat" style="background:#111;">
            <div class="app-header">
                <div style="width:35px; height:35px; background:linear-gradient(135deg, #db0011, #800000); border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold;">AI</div>
                <div>
                    <div style="font-weight:bold; font-size:0.9rem;">Premier Assistant</div>
                    <div style="font-size:0.75rem; color:var(--term-green);">‚óè Secure Connection</div>
                </div>
            </div>
            <div class="chat-container" id="chatBody"></div>
        </div>

    </div>
    
    <div class="control-bar">
        <button class="next-btn" id="nextBtn" onclick="nextScene()">Start Full Demo</button>
    </div>
</div>

<script>
    const script = [
        {
            // Scene 1: Technical Setup
            phase: "PHASE 0: THE AGREEMENT",
            time: "3 Weeks Ago",
            title: "Scene 1: Explicit Consent",
            desc: "Christopher configures his HSBC Premier App. He enables <strong>Critical Moment Intervention</strong>. <br><br>This is the foundation: User Control. He effectively hires the AI to watch his back.",
            log: `> USER_CONFIG_UPDATE:
  - CRITICAL_MOMENT_INTERVENTION: <span class="term-val">TRUE</span>
  - DATA_PRIVACY: <span class="term-val">ON_DEVICE_FIRST</span>
> STATUS: CONSENT_GRANTED`,
            screen: "scr-settings"
        },
        {
            // Scene 2: The external event
            phase: "PHASE 1: THE TRANSACTION",
            time: "Now",
            title: "Scene 2: External Trigger",
            desc: "Christopher is on <strong>Safari</strong>. He pays ¬£3.00 for a land title deed.<br><br>Physically, he is outside the bank app. But data flows securely to the core banking system.",
            log: `> TRX_DETECTED (CORE_BANKING):
  - MERCH: "HM LAND REGISTRY"
  - AMT: ¬£3.00
  - STATUS: <span class="term-val">APPROVED</span>
> CONTEXT: USER_IS_BROWSING_SAFARI`,
            screen: "scr-safari"
        },
        {
            // Scene 3: Backend Logic
            phase: "PHASE 2: THE TOUCHPOINT",
            time: "Real-time",
            title: "Scene 3: Real-time Analysis",
            desc: "The AI Engine correlates the ¬£3.00 payment with his Portfolio Status (High Stock, Low Cash).<br><br><strong>Decision:</strong> Don't sell stocks. Offer Lombard Loan.<br><strong>Action:</strong> Send Value-based Notification.",
            log: `> AI_ENGINE:
  - PATTERN: HOME_BUYING_INTENT (98%)
  - LIQUIDITY: GAP_DETECTED
> TRIGGER: PUSH_NOTIFICATION
> CONTENT: "Optimization Opportunity"`,
            action: "show_notif"
        },
        {
            // Scene 4: The Transition (Entry)
            phase: "PHASE 3: THE ENTRY",
            time: "+5 Seconds",
            title: "Scene 4: Secure Transition",
            desc: "Christopher taps the notification. <br><br><strong>1. Authentication:</strong> FaceID verifies him instantly.<br><strong>2. Deep Link:</strong> The app opens directly to the relevant AI context.",
            log: `> EVENT: NOTIFICATION_CLICK
> SECURITY: BIOMETRIC_CHALLENGE... <span class="term-val">VERIFIED</span>
> DEEP_LINK: /ai-assistant/context=liquidity_opt
> VIEW_SWITCH: SAFARI -> HSBC_APP`,
            action: "simulate_entry"
        },
        {
            // Scene 5: The Interaction begins (Fixed: Logic continuity)
            phase: "PHASE 4: THE INTERACTION",
            time: "In-App",
            title: "Scene 5: The Hard Signal",
            desc: "We are now inside the App. The AI immediately references the external signal to establish context.",
            log: `> CHAT_INIT:
  - REF_TRX: "HM LAND REGISTRY"
  - TONE: DIRECT_ADVISORY
> MSG_GEN: "Checking title deed?"`,
            action: "msg_1" // AI speaks first
        },
        {
            // Scene 6: User Doubt
            phase: "PHASE 4: THE INTERACTION",
            time: "In-App",
            title: "Scene 6: Engagement & Skepticism",
            desc: "Christopher is intrigued but wary. He challenges the AI.",
            log: `> USER_INPUT: "Why trigger?"
> SENTIMENT: <span class="term-warn">CAUTIOUS</span>
> STRATEGY: RADICAL_TRANSPARENCY`,
            action: "msg_user_skeptic" // User replies
        },
        {
            // Scene 7: Explanation
            phase: "PHASE 4: THE INTERACTION",
            time: "In-App",
            title: "Scene 7: The Logic",
            desc: "The AI explains the link between the payment and his portfolio, referencing the permission granted in Scene 1.",
            log: `> RESPONSE_GEN:
  - LINK: LAND_REGISTRY_PAYMENT -> PROPERTY_BUY
  - RISK: CAPITAL_GAINS_TAX
  - SOLUTION: LOMBARD_LOAN`,
            action: "msg_ai_explain"
        },
        {
            // Scene 8: The Widget
            phase: "PHASE 4: THE INTERACTION",
            time: "In-App",
            title: "Scene 8: The Value Proposition",
            desc: "The AI pivots to advising. It hits the pain point: Tax & Opportunity Cost.",
            log: `> WIDGET_RENDER: LOMBARD_SIM
  - PLEDGE: TENCENT (HKD)
  - RATE: 3.8% (PREMIER)
> VALUE: AVOID_TAX_EVENT`,
            action: "msg_ai_widget"
        },
        {
            // Scene 9: Handoff
            phase: "PHASE 4: THE INTERACTION",
            time: "In-App",
            title: "Scene 9: Trust & Handoff",
            desc: "Christopher sees the math works. The AI brings in the human expert.",
            log: `> INTENT: HIGH_BUY
> HANDOFF_PROTOCOL: SARAH_JENKINS (RM)
> STATUS: CONVERSION_SECURED`,
            action: "msg_handoff"
        }
    ];

    let currentStep = 0;

    function nextScene() {
        if (currentStep >= script.length) return;
        
        const data = script[currentStep];
        const btn = document.getElementById('nextBtn');
        const panel = document.getElementById('storyPanel');

        // 1. Render Narrative Card
        // Remove old active
        document.querySelectorAll('.scene-card').forEach(c => c.classList.remove('active'));
        
        const card = document.createElement('div');
        card.className = 'scene-card active';
        
        // Unified Card Content
        card.innerHTML = `
            <div class="scene-header">
                <span>${data.phase}</span>
                <span>${data.time}</span>
            </div>
            <div class="scene-title">${data.title}</div>
            <div class="scene-desc">${data.desc}</div>
            <div class="system-log">${data.log.replace(/\n/g, '<br>')}</div>
        `;
        panel.appendChild(card);
        card.scrollIntoView({behavior: 'smooth'});

        // 2. Switch Screens
        if (data.screen) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(data.screen).classList.add('active');
        }

        // 3. Handle Actions
        // Scene 3: Push Notification
        if (data.action === "show_notif") {
            setTimeout(() => document.getElementById('notif').classList.add('show'), 500);
        }

        // Scene 4: Entry (Auto simulate click if user hasn't)
        if (data.action === "simulate_entry") {
            userClicksNotification();
        }

        // Scene 5: AI First Message
        if (data.action === "msg_1") {
            addChat("ai", "Good evening, Christopher. I see your ¬£3.00 payment to the Land Registry was just approved.<br><br>Based on your portfolio, are you checking documents for a potential acquisition?");
        }

        // Scene 6: User Skepticism
        if (data.action === "msg_user_skeptic") {
            setTimeout(() => addChat("user", "Yes, checking the deed. But why is this triggering a liquidity alert?"), 800);
        }

        // Scene 7: AI Explanation
        if (data.action === "msg_ai_explain") {
            addChat("ai", "Because your liquidity is tied up in Tencent ($3.2M). Selling now triggers Capital Gains Tax.<br><br>I can show you a way to keep the stocks and still buy the property.");
        }

        // Scene 8: The Widget
        if (data.action === "msg_ai_widget") {
            setTimeout(() => {
                addChat("user", "Show me.");
            }, 500);
            setTimeout(() => {
                addChat("ai", `
                    <div class="widget">
                        <div style="color:var(--gold); border-bottom:1px solid #333; margin-bottom:10px; padding-bottom:5px;">HSBC Asset Financing</div>
                        <div class="w-row"><span>Pledge (Tencent):</span> <span class="w-val">HKD 8.0M</span></div>
                        <div class="w-row"><span>Cash Unlocked:</span> <span class="w-val">¬£600,000</span></div>
                        <div class="w-row"><span>Tax Saved:</span> <span class="w-val" style="color:var(--term-green)">$42,000</span></div>
                        <div class="w-row"><span>Your Rate:</span> <span class="w-val" style="color:var(--gold); font-size:16px;">3.85%</span></div>
                        <button class="w-btn">Generate Term Sheet</button>
                    </div>
                `);
            }, 1500);
        }

        // Scene 9: Handoff
        if (data.action === "msg_handoff") {
            setTimeout(() => addChat("user", "3.85% is compelling. Is this pre-approved?"), 500);
            setTimeout(() => addChat("ai", "Yes. I've notified Sarah Jenkins (your RM). She has the paperwork ready for your digital signature."), 2000);
        }

        currentStep++;
        if (currentStep < script.length) {
            btn.innerText = "Next Scene >";
        } else {
            btn.innerText = "Demo Complete";
            btn.disabled = true;
        }
    }

    // Interaction Logic
    function userClicksNotification() {
        const notif = document.getElementById('notif');
        const faceId = document.getElementById('faceId');
        
        notif.classList.remove('show');
        faceId.style.opacity = 1;
        
        setTimeout(() => {
            faceId.style.opacity = 0;
            document.getElementById('scr-safari').classList.remove('active');
            document.getElementById('scr-chat').classList.add('active');
        }, 1500);
    }

    function addChat(type, html) {
        const body = document.getElementById('chatBody');
        const div = document.createElement('div');
        div.className = `bubble ${type}`;
        div.innerHTML = html;
        body.appendChild(div);
        body.scrollTop = body.scrollHeight;
    }
</script>

</body>
</html>